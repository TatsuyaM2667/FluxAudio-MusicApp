# パフォーマンス最適化について

このアプリケーションでは、以下のパフォーマンス最適化を実装しています：

## 実装済みの最適化

### 1. メタデータ読み込みの並列化
- 最初の30曲を優先的に読み込み（3つ同時並列処理）
- 残りの曲はバックグラウンドで読み込み
- これにより初期表示が大幅に高速化

### 2. IndexedDBキャッシング
- 曲のメタデータ（タイトル、アーティスト、アルバムアート）をキャッシュ
- 2回目以降の訪問では瞬時に表示

### 3. 画像の遅延読み込み
- アルバムアート画像に `loading="lazy"` を設定
- 画面に表示される直前まで読み込みを遅延

### 4. タ<br/>アウト設定
- API リクエストにタイムアウトを設定（10秒）
- ネットワークの問題で無限に待たないように

## ESP32側で推奨される最適化

### 1. HTTPヘッダーの最適化
```cpp
// Connection: keep-alive を有効化
server.sendHeader("Connection", "keep-alive");

// キャッシュヘッダーの追加
server.sendHeader("Cache-Control", "public, max-age=3600");
```

### 2. gzip圧縮の有効化（可能であれば）
```cpp
// 応答の圧縮
server.sendHeader("Content-Encoding", "gzip");
```

### 3. Range リクエストのサポート
ストリーミング再生を改善するため、部分的なコンテンツ取得をサポート：

```cpp
if (server.hasHeader("Range")) {
  // Range ヘッダーを処理
  // 206 Partial Content を返す
}
```

## 今後の改善案

1. **仮想スクロール**: 数百曲以上ある場合は、react-windowなどで仮想スクロール実装
2. **サムネイル生成**: ESP32側で小さいサムネイル画像を生成
3. **メタデータAPI**: ESP32で `/metadata` エンドポイントを作成し、JSONでメタデータのみ返す
